{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog","author":"Kyle Mathews"}},"markdownRemark":{"id":"/Users/satansdeersatansdeer/Workspace/satansdeer.github.com/src/pages/getting-schwifty-with-pull-requests/index.md absPath of file >>> MarkdownRemark","html":"<p>Once I was working on a big feature. Everything was going fine until I got carried away and started to commit everything in one branch instead of splitting to multiple smaller ones. As a result I ended up with a huge PR that no one was able to review properly.</p>\n<p>Let’s see how can you avoid getting in that situation and what to do if you already did.</p>\n<p>First of all – do some planning and break task in parts. This is the only way you’ll be able to avoid creating this monstrosity of a pull request.</p>\n<p>Then you’ll have two options, with both of them you create small PR’s with gradual improvements:</p>\n<ul>\n<li>Merging PR’s to master early and often.</li>\n<li>Having a long running feature PR with small reviewable child PR’s.</li>\n</ul>\n<p>The difference is what you are basing them off. In first case you base them on <code class=\"language-text\">master</code> and in second you base them on a feature branch.</p>\n<h2>Merging Early And Often</h2>\n<p>This is the <strong>preferred option</strong>. You better have a good plan of what you are going to do though. You don’t want to end up creating meaningless pull requests with lonely components that don’t interact with anything. Like models that no one uses.</p>\n<p>Do it as incremental improvements. In your first PR set the base structure and then gradually improve it by adding more components and upgrading the old ones.</p>\n<h2>Long Running Feature PR</h2>\n<p>You’ll have to rebase the base branch with master and then rebase it’s children as well.</p>\n<p>This approach might require some cherry-picking between branches if you’ll be working in parallel with someone else.</p>\n<p>Don’t forget to do the housekeeping and creating small PR’s for every new feature or you are going to end up with…</p>\n<h2>The Worst Case</h2>\n<p>It started as a long running feature PR approach. But then I kinda slacked off with the housekeeping and started to commit everything in one of the child PRs.</p>\n<p>Eventually I ended up with a huge PR with 100+ commits and 1.5k lines of code.</p>\n<p>This is a very bad situation. Even if someone would dare to review it, he’ll be more likely to overlook something.</p>\n<p>So if you found yourself in similar situation – you need to do something to this PR to make it reviewable. For example you can…</p>\n<h2>Break It Into A Stack Of PRs</h2>\n<p>When searching for a solution I found <a href=\"https://graysonkoonce.com/stacked-pull-requests-keeping-github-diffs-small/\">this blog-post</a> of Grayson Koonce where a he proposed to close the original PR, copy it’s changes to a new branch and then create a stack of dependent PRs with incremental changes one on top of another.</p>\n<h2>First step</h2>\n<p>First you want to create a new branch based on <code class=\"language-text\">master</code> with all the changes from that huge PR unstaged.</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">git</span> checkout master\n$ <span class=\"token function\">git</span> checkout -b stacked-pr-example-1 branch-of-that-huge-pr\n$ <span class=\"token function\">git</span> reset master\n$ <span class=\"token function\">git</span> status</code></pre>\n      </div>\n<p>Now you’ll see all the changes that were introduced in that huge PR in uncommited state.\nYou can start commiting the changes and making stacked PRs.</p>\n<h2>First Pull Request</h2>\n<p>You’ll have to use <code class=\"language-text\">git add --patch</code> to add specific changes to a commit. I have a <a href=\"/posts/git-add-patch\">post about this command</a>.</p>\n<p>But if you have unstaged new files – git won’t be able to add them this way. To fix it apply <code class=\"language-text\">git add -N</code> or <code class=\"language-text\">--intent-to-add</code> to a file you want to see in your commit. This will tell git to add file itself but not it contents. After that you will be able to add lines from that file easily.</p>\n<p>At this point you might want to check how many changed lines you’ve already added. Use <code class=\"language-text\">git diff --staged --stat</code> for this.</p>\n<p>Once you’ve staged all the needed changes, stash everything else and verify that it still works.</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">git</span> stash --include-untracked --keep-index</code></pre>\n      </div>\n<p><code class=\"language-text\">--keep-index</code> will make it stash only files that have not been added and <code class=\"language-text\">--include-untracked</code> will allow it to stash untracked files as well.</p>\n<p>Time to commit the changes and create the PR.</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">git</span> commit -m <span class=\"token string\">\"Make some change to x\"</span>\n$ <span class=\"token function\">git</span> push -u origin stacked-pr-example-1</code></pre>\n      </div>\n<p>There is a nice CLI tool <code class=\"language-text\">hub</code> that will allow us to create a PRs easier:</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-bash\"><code class=\"language-bash\">$ hub pull-request</code></pre>\n      </div>\n<p>It will open the default editor and you’ll be able to add PR descirption.</p>\n<h2>Next Pull Requests</h2>\n<p>Now create the branch for your next PR and pop the stash back:</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">git</span> checkout -b stacked-pr-example-2\n$ <span class=\"token function\">git</span> stash pop</code></pre>\n      </div>\n<p>Repeat the <code class=\"language-text\">add</code>, <code class=\"language-text\">stash</code>, <code class=\"language-text\">commit</code> steps.</p>\n<p>Now create new PR, but make sure to base it off of the previous branch with the -b flag:</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-bash\"><code class=\"language-bash\">hub pull-request -b stacked-pr-example-1</code></pre>\n      </div>\n<p>Repeat the process until the changes are packed into PRs.</p>\n<h2>After You’ve Got Your PRs Reviewed</h2>\n<p>Here Grayson gives an important tip to propagate additional commits via <code class=\"language-text\">git merge</code> instead of <code class=\"language-text\">git rebase</code>.\nThis way you’ll be able to resolve conflicts in multiple commits in one go.</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">git</span> checkout stacked-pr-example-2\n$ <span class=\"token function\">git</span> commit -am <span class=\"token string\">\"Addressed this feedback\"</span>\n$ <span class=\"token function\">git</span> commit -am <span class=\"token string\">\"Addressed that feedback\"</span>\n$ <span class=\"token function\">git</span> push stacked-pr-example-2\n\n$ <span class=\"token function\">git</span> checkout stacked-pr-example-3\n$ <span class=\"token function\">git</span> merge stacked-pr-example-2 <span class=\"token comment\"># integrate changes from stacked-pr-example-2</span></code></pre>\n      </div>\n<p>Now, after you’ve applied all feedback and got you PRs approved – time to land the stack.</p>\n<p>As github <a href=\"https://github.com/blog/2224-change-the-base-branch-of-a-pull-request\">supports updating the base branch</a> since August 2016, you can merge your stack in any order.</p>","frontmatter":{"title":"Getting Schwifty With Pull Requests","date":"September 30, 2017"}}},"pathContext":{"slug":"/getting-schwifty-with-pull-requests/","previous":{"fields":{"slug":"/magical-mystery-guide-for-async-await-in-javascript/"},"frontmatter":{"title":"Magical Mystery Guide For Async/Await In Javascript"}},"next":{"fields":{"slug":"/skills-of-an-effective-developer/"},"frontmatter":{"title":"7 Skills Of An Effective Developer"}}}}